
@[TOC](redisæºç é˜…è¯»&å®è·µ ä¹‹ åŸºç¡€æ•°æ®ç»“æ„å‹ç¼©é“¾è¡¨)
# ç»™æ–°è§‚ä¼—è€çˆ·çš„å¼€åœº
å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å¼Ÿå¼Ÿï¼
æœ€è¿‘è¯»äº†ä¸€é é»„å¥å®å¤§ä½¬çš„ **<<Redis è®¾è®¡ä¸å®ç°>>**ï¼Œå¯¹Redis 3.0ç‰ˆæœ¬æœ‰äº†ä¸€äº›è®¤è¯†ï¼Œè¯¥ä¹¦ä½œè€…æœ‰ä¸€ç‰ˆæ·»åŠ äº†æ³¨é‡Šçš„ redis 3.0æºç 
[ğŸ‘‰å®˜æ–¹redisçš„githubä¼ é€é—¨](https://github.com/antirez/redis)ã€‚
[ğŸ‘‰é»„å¥å®å¤§ä½¬æ·»åŠ äº†æ³¨é‡Šçš„ redis 3.0æºç ä¼ é€é—¨](https://github.com/huangz1990/redis-3.0-annotated.git)


ç½‘ä¸Šè¯´Redisä»£ç å†™å¾—å¾ˆå¥½ï¼Œä¸ºäº†åŠ æ·±å°è±¡å’Œå­¦ä¹ rediså¤§ä½¬çš„ä»£ç å†™ä½œè‰ºæœ¯ï¼Œäº†è§£å·¥ä½œä¸­ä½¿ç”¨çš„redis å‘½ä»¤èƒŒåçš„æºç é€»è¾‘ï¼Œä¾¿æœ‰äº†ä»rediså‘½ä»¤è§’åº¦å­¦ä¹ redisæºç çš„æƒ³æ³•ã€‚
(å…¨æ–‡æåˆ°çš„redisæœåŠ¡å™¨ï¼Œéƒ½æŒ‡åœ¨ **mac os ä¸Šå¯åŠ¨çš„ä¸€ä¸ªé»˜è®¤é…ç½®çš„å•æœºredisæœåŠ¡å™¨**)

# ziplistæ˜¯ä»€ä¹ˆï¼Ÿ
redisçš„é“¾è¡¨æ•°æ®ç±»å‹ï¼Œåœ¨åº•å±‚æœ‰ä¸¤ç§æ•°æ®ç»“æ„å®ç°.
ä¸€ç§æ˜¯[ä¸Šä¸€ç¯‡è®²åˆ°listæ•°æ®ç»“æ„](https://blog.csdn.net/a158372582/article/details/106086284),
å¦å¤–ä¸€ç§å°±æ˜¯ `å‹ç¼©é“¾è¡¨ ziplist`ã€‚
é‚£è¿™ä¸ªzipliståˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ

å¼Ÿå¼Ÿ:"ä»åå­—ä¸Šçœ‹ï¼Œå‹ç¼©åˆ—è¡¨ï¼Œå°±æ˜¯ä¸€ä¸ªè¢«å‹ç¼©äº†çš„åˆ—è¡¨"
è§‚ä¼—è€çˆ·: "...ï¼Œè¦ä½ æœ‰ä½•ç”¨ï¼Œä½ ä¸è¯´æˆ‘ä»¬ä¹Ÿèƒ½çœ‹å‡ºæ¥ã€‚ğŸ˜¡"
å¼Ÿå¼Ÿ:"...ä¸å¥½æ„æ€ï¼Œæ‰“æ‰°äº†ğŸ™ƒï¸"
å¼Ÿå¼Ÿ: "`redisçš„å‹ç¼©åˆ—è¡¨,å­˜å‚¨åœ¨è¿ç»­çš„å†…å­˜ç©ºé—´ä¸­,æ²¡æœ‰ä»£ç å±‚é¢çš„æ•°æ®ç»“æ„å®šä¹‰,ä¾èµ–è®¾è®¡å¥½çš„äºŒè¿›åˆ¶æ ¼å¼æ¥è¿›è¡Œæ“ä½œã€‚`"
è§‚ä¼—è€çˆ·:"ä½ è¿™è®²å¾—ä¸å¤Ÿä¸“ä¸šå•Šï¼Œä¹Ÿä¸å½¢è±¡ã€‚"
å¼Ÿå¼Ÿ:"ğŸ˜­ï¼Œå¥½çš„äº†è§£ã€‚
é‚£è®©æˆ‘ä»¬æ¥ ç»“åˆ redisé‡Œçš„è‹±æ–‡æ³¨é‡Š å’Œ é»„å¥å®å¤§ä½¬çš„ä¸­æ–‡æ³¨é‡Š æ¥çœ‹çœ‹æ˜¯æ€ä¹ˆè®²çš„"
ï¼ˆps: è¯¥æ³¨é‡Šå‡ºç°åœ¨ ziplist.c æ–‡ä»¶ä¸­ï¼‰

## ziplistçš„è®¾è®¡ç›®çš„
ğŸ‘‡
```javascript
 * The ziplist is a specially encoded dually linked list that is designed
 * to be very memory efficient. 
 * Ziplist æ˜¯ä¸ºäº†å°½å¯èƒ½åœ°èŠ‚çº¦å†…å­˜è€Œè®¾è®¡çš„ç‰¹æ®Šç¼–ç åŒç«¯é“¾è¡¨ã€‚
```
## ziplistçš„ä½œç”¨
ğŸ‘‡
```javascript
 * It stores both strings and integer values,
 * where integers are encoded as actual integers instead of a series of
 * characters. 
 * Ziplist å¯ä»¥å‚¨å­˜å­—ç¬¦ä¸²å€¼å’Œæ•´æ•°å€¼ï¼Œ
 * å…¶ä¸­ï¼Œæ•´æ•°å€¼è¢«ä¿å­˜ä¸ºå®é™…çš„æ•´æ•°ï¼Œè€Œä¸æ˜¯å­—ç¬¦æ•°ç»„ã€‚
```
## ziplistçš„å°ç‘•ç–µ
ğŸ‘‡
```javascript
 * It allows push and pop operations on either side of the list
 * in O(1) time. However, because every operation requires a reallocation of
 * the memory used by the ziplist, the actual complexity is related to the
 * amount of memory used by the ziplist.
 * Ziplist å…è®¸åœ¨åˆ—è¡¨çš„ä¸¤ç«¯è¿›è¡Œ O(1) å¤æ‚åº¦çš„ push å’Œ pop æ“ä½œã€‚
 * ä½†æ˜¯ï¼Œå› ä¸ºè¿™äº›æ“ä½œéƒ½éœ€è¦å¯¹æ•´ä¸ª ziplist è¿›è¡Œå†…å­˜é‡åˆ†é…ï¼Œ
 * æ‰€ä»¥å®é™…çš„å¤æ‚åº¦å’Œ ziplist å ç”¨çš„å†…å­˜å¤§å°æœ‰å…³ã€‚
```
## ziplist çš„ç©ºé—´å¸ƒå±€
ziplistçš„ç©ºé—´å¸ƒå±€ï¼ŒæŒ‰ä½åœ°å€å‘é«˜åœ°å€çš„æ–¹å‘ å¦‚ä¸‹
1. å¼€å¤´ç”¨ `å››ä¸ªå­—èŠ‚æ¥å­˜æ”¾ziplistçš„å­—èŠ‚æ•°å¤§å°`
2. æ¥ç€ç”¨ `å››ä¸ªå­—èŠ‚æ¥å­˜æ”¾ziplistå°¾èŠ‚ç‚¹çš„åç§»å­—èŠ‚æ•°`
3. ç„¶åæ˜¯ `2ä¸ªå­—èŠ‚è¡¨ç¤ºè¯¥ziplisté‡Œæ”¾äº†å¤šå°‘ä¸ªèŠ‚ç‚¹`
4. æ¥ç€å°±æ˜¯ `<èŠ‚ç‚¹>,<èŠ‚ç‚¹>,<èŠ‚ç‚¹>... 0åˆ°nä¸ª`
5. æœ€åæ˜¯ `ä¸€ä¸ªå­—èŠ‚çš„ziplistç»“æŸæ ‡å¿— 255`

ğŸ‘‡çœ‹ä¸€éæ³¨é‡Š
```javascript
 * ZIPLIST OVERALL LAYOUT:
 * Ziplist çš„æ•´ä½“å¸ƒå±€ï¼š
 * The general layout of the ziplist is as follows:
 * ä»¥ä¸‹æ˜¯ ziplist çš„ä¸€èˆ¬å¸ƒå±€ï¼š
 * <zlbytes><zltail><zllen><entry><entry><zlend>
```
### zlbytesçš„å«ä¹‰
```javascript
 * <zlbytes> is an unsigned integer to hold the number of bytes that the
 * ziplist occupies. This value needs to be stored to be able to resize the
 * entire structure without the need to traverse it first.
 * <zlbytes> æ˜¯ä¸€ä¸ªæ— ç¬¦å·æ•´æ•°ï¼Œä¿å­˜ç€ ziplist ä½¿ç”¨çš„å†…å­˜æ•°é‡ã€‚
 * é€šè¿‡è¿™ä¸ªå€¼ï¼Œç¨‹åºå¯ä»¥ç›´æ¥å¯¹ ziplist çš„å†…å­˜å¤§å°è¿›è¡Œè°ƒæ•´ï¼Œ
 * è€Œæ— é¡»ä¸ºäº†è®¡ç®— ziplist çš„å†…å­˜å¤§å°è€Œéå†æ•´ä¸ªåˆ—è¡¨ã€‚
```
### zltailçš„å«ä¹‰
```javascript
 * <zltail> is the offset to the last entry in the list. This allows a pop
 * operation on the far side of the list without the need for full traversal.
 * <zltail> ä¿å­˜ç€åˆ°è¾¾åˆ—è¡¨ä¸­æœ€åä¸€ä¸ªèŠ‚ç‚¹çš„åç§»é‡ã€‚
 * è¿™ä¸ªåç§»é‡ä½¿å¾—å¯¹è¡¨å°¾çš„ pop æ“ä½œå¯ä»¥åœ¨æ— é¡»éå†æ•´ä¸ªåˆ—è¡¨çš„æƒ…å†µä¸‹è¿›è¡Œã€‚
```
### zllençš„å«ä¹‰
```javascript
 * <zllen> is the number of entries.When this value is larger than 2**16-2,
 * we need to traverse the entire list to know how many items it holds.
 * <zllen> ä¿å­˜ç€åˆ—è¡¨ä¸­çš„èŠ‚ç‚¹æ•°é‡ã€‚
 * å½“ zllen ä¿å­˜çš„å€¼å¤§äº 2**16-2 æ—¶ï¼Œï¼ˆå¤§äºç­‰äº 65535 æ—¶ï¼‰
 * ç¨‹åºéœ€è¦éå†æ•´ä¸ªåˆ—è¡¨æ‰èƒ½çŸ¥é“åˆ—è¡¨å®é™…åŒ…å«äº†å¤šå°‘ä¸ªèŠ‚ç‚¹ã€‚
```
 ### zlendçš„å«ä¹‰
 ```javascript
 * <zlend> is a single byte special value, equal to 255, which indicates the
 * end of the list.
 * <zlend> çš„é•¿åº¦ä¸º 1 å­—èŠ‚ï¼Œå€¼ä¸º 255 ï¼Œæ ‡è¯†åˆ—è¡¨çš„æœ«å°¾ã€‚
 ```
è§‚ä¼—è€çˆ·:"wo*, è¿™ä¸ªziplistçš„æ ¼å¼æœ‰ç‚¹å¤æ‚å•Š"
å¼Ÿå¼Ÿ:"æ˜¯å•Šï¼Œæœ‰ç‚¹å¤æ‚ï¼Œè¿˜æœ‰ziplistçš„èŠ‚ç‚¹æ ¼å¼æ²¡è¯´å‘¢ ï¼Œ
ziplistçš„èŠ‚ç‚¹æ ¼å¼ åŠ ç›¸å…³ä»£ç  æ˜¯é€ æˆziplistå¤æ‚çš„çœŸæ­£å…ƒå‡¶ğŸ™ƒï¸"

### ziplistçš„èŠ‚ç‚¹æ ¼å¼
`ziplistèŠ‚ç‚¹` çš„ç©ºé—´å¸ƒå±€ï¼Œå¤§è‡´åˆ†ä¸ºä¸‰éƒ¨åˆ†ã€‚
1. æè¿°å‰ä¸€ä¸ªèŠ‚ç‚¹å ç”¨çš„ç©ºé—´å¤§å°
2. æè¿°æœ¬èŠ‚ç‚¹çš„å€¼çš„ç±»å‹ï¼Œé•¿åº¦
3. å€¼æœ¬èº«

è¯¦ç»†ç»“æ„ï¼ŒæŒ‰ä½åœ°å€å‘é«˜åœ°å€çš„æ–¹å‘ å¦‚ä¸‹
1. `1or5ä¸ªå­—èŠ‚`è¡¨ç¤º`å‰é¢ä¸€ä¸ªèŠ‚ç‚¹çš„ å­—èŠ‚æ•°å¤§å°`ã€‚ 
è‹¥ç¬¬1ä¸ªå­—èŠ‚ å°äº `#define ZIP_BIGLEN 254`ï¼Œåˆ™è¯¥å­—èŠ‚ç›´æ¥è¡¨ç¤ºå‰ä¸€ä¸ªèŠ‚ç‚¹çš„å­—èŠ‚æ•°å¤§å°
å¦åˆ™ä¸º5ä¸ªå­—èŠ‚ï¼Œç¬¬2,3,4,5å­—èŠ‚ä¸€èµ·æ„æˆä¸€ä¸ª 32ä¸ºæ•´æ•°è¡¨ç¤ºå‰ä¸€èŠ‚ç‚¹çš„å¤§å°
2. ç´§æ¥ç€çš„ `1or2or5 å­—èŠ‚`ä¸€å…±è¡¨ç¤ºäº†ä¸‰ç±»ä¿¡æ¯
1-  `å½“å‰èŠ‚ç‚¹å€¼ç±»å‹`ï¼Œ
2- `æè¿°å½“å‰èŠ‚ç‚¹å€¼çš„é•¿åº¦æ‰€éœ€è¦çš„ç©ºé—´å¤§å°çš„ç±»å‹`ï¼Œ
3- `å½“å‰èŠ‚ç‚¹å€¼çš„é•¿åº¦` ....
è¿™ä¹Ÿå¤ªèƒ½çœäº†ï¼Œé€šè¿‡æé«˜ç»“æ„çš„å¤æ‚ç¨‹åº¦å¼„æ™•è®¡ç®—æœºæ¥èŠ‚çœå­˜å‚¨ç©ºé—´ ğŸ™ƒï¸

	2.1 ç¬¬ä¸€ä¸ªå­—èŠ‚å« `encoding`
	å¦‚æœ encoding å°äº `#define ZIP_STR_MASK 0xc0`(äºŒè¿›åˆ¶ 11000000),
	é‚£è¯¥èŠ‚ç‚¹å­˜çš„æ˜¯å­—ç¬¦ä¸²ç±»å‹ã€‚
	é‚£ä¹ˆ æè¿°è¯¥å­—ç¬¦ä¸²é•¿åº¦æ‰€éœ€è¦çš„å­˜å‚¨ç©ºé—´å¤§å°çš„ç±»å‹å°±æ˜¯ encoding & ZIP_STR_MASK
	å–å€¼åˆ†åˆ«ä»¥ä¸‹ä¸‰ç§,
	```javascript
	`/** å­—ç¬¦ä¸²ç¼–ç ç±»å‹
                                            //0x3f  00111111
                                            //0xc0  11000000
    #define ZIP_STR_06B (0 << 6)            //      00000000
   #define ZIP_STR_14B (1 << 6)            //      01000000
   #define ZIP_STR_32B (2 << 6)            //      10000000
   `
	```
	
	`6B,14B,32Bçš„æ„æ€æ˜¯,æè¿°å­—ç¬¦ä¸²é•¿åº¦æ‰€éœ€è¦çš„ç©ºé—´åˆ†åˆ«æ˜¯6ä½/14ä½/32ä½ï¼Œ`
	`ä¸”æè¿°å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œæ˜¯æŒ‰å¤§ç«¯åºå­˜æ”¾çš„ï¼Œä¸”å‰6ä½å­˜æ”¾åœ¨äº†encodingé‡Œ,é¢å¤–çš„ç©ºé—´ç´§æ¥ç€encoding`
	`æ‰€ä»¥æè¿°è¿™ä¸‰ç§ å­—ç¬¦ä¸²ç±»å‹ã€å­˜å‚¨å­—ç¬¦ä¸²é•¿åº¦çš„ç©ºé—´å¤§å°ï¼Œä»¥åŠå­—ç¬¦ä¸²çš„é•¿åº¦ ä¸€å…±éœ€è¦ 1/2/5ä¸ªå­—èŠ‚`
	
	å¦‚æœä¸€ä¸‹å°±çœ‹æ‡‚äº†ï¼Œé‚£è¯´æ˜ä½ çœŸæ˜¯ä¸ªèªæ˜çš„è§‚ä¼—è€çˆ·å‘¢ğŸ˜Š
	ğŸ™ƒï¸å¦‚æœçœ‹æ™•äº†ï¼Œæ²¡å…³ç³»ï¼Œæˆ‘ä»¬å¯¹ç€æ•´æ•°ç±»å‹å†æ¥ä¸€éğŸ˜Š	
	
	å¦‚æœ encoding å¤§äºç­‰äº `#define ZIP_STR_MASK 0xc0`(äºŒè¿›åˆ¶ 11000000)
	é‚£è¯¥èŠ‚ç‚¹çš„å€¼æ˜¯ä¸€ä¸ªæ•´æ•°
	é‚£ä¹ˆ æè¿°è¯¥å­—ç¬¦ä¸²é•¿åº¦æ‰€éœ€è¦çš„å­˜å‚¨ç©ºé—´å¤§å°çš„ç±»å‹ å°±æ˜¯ encodingæœ¬èº« ğŸ‘‡
	```javascript
	/* 
	* æ•´æ•°ç¼–ç ç±»å‹
	*  */
	* #define ZIP_INT_16B (0xc0 | 0 << 4)     //      11000000
	* #define ZIP_INT_32B (0xc0 | 1 << 4)     //      11010000
	* #define ZIP_INT_64B (0xc0 | 2 << 4)     //      11100000
	* #define ZIP_INT_24B (0xc0 | 3 << 4)     //      11110000
	* #define ZIP_INT_8B 0xfe                 // 0xFE 11111110
	```
	
	8B/16B/24B/32B/64B å¯¹åº”çš„ å€¼çš„é•¿åº¦ åˆ†åˆ«æ˜¯ (8ä½/16ä½/24ä½/32ä½/64ä½)
	æ‰€ä»¥æ•´æ•°ç±»å‹ä¸å­—ç¬¦ä¸²ç±»å‹ä¸åŒçš„åœ°æ–¹åœ¨äº
	`ziplistæ•´æ•°ç±»å‹èŠ‚ç‚¹ï¼Œä»…éœ€è¦ä¸€ä¸ªå­—èŠ‚ï¼Œå°±å¯ä»¥æè¿°å­˜å‚¨çš„å€¼çš„æ˜¯æ•°å­—ç±»å‹ï¼Œå’Œå€¼å ç”¨çš„ç©ºé—´å­—èŠ‚æ•° `
	
	æ•´æ•°è¿˜æœ‰ä¸€ä¸ªéšè—ç±»å‹ï¼Œå¦‚æœæ˜¯æ•´æ•°[0,12], åˆ™å°†å€¼ç›´æ¥ä¿å­˜åˆ°äº†encodingä¸­ğŸ˜
	encodingå–å€¼åœ¨ä¸‹é¢ä¸¤ä¸ªå€¼ä¹‹é—´(åŒ…å«),é‚£ä¹ˆencoding - ZIP_INT_IMM_MIN - 1 çš„ç»“æœå°±ç›´æ¥æ˜¯æ•´æ•°å€¼,è‡ªç„¶åœ°è¯¥èŠ‚ç‚¹ä¸éœ€è¦å†å­˜å‚¨ä¸€ä»½å€¼ã€‚
	`#define ZIP_INT_IMM_MIN 0xf1  /* 11110001 */`
`#define ZIP_INT_IMM_MAX 0xfd  /* 11111101 */`
3. ç¬¬ä¸‰éƒ¨åˆ†å°±æ˜¯èŠ‚ç‚¹çš„å€¼æœ¬èº«å•¦ï¼Œåœ¨3.0ç‰ˆæœ¬ä¸­å€¼è¢«æœ¬èº«æ˜¯æ²¡æœ‰ç»è¿‡å‹ç¼©å¤„ç†çš„ã€‚

# ziplist insert!
æŒ‰ç…§å›½é™…æƒ¯ä¾‹å•Šï¼Œredisæ˜¯æœ‰ key/value æ•°æ®åº“çš„è¯´æ³•çš„ã€‚
æ—¢ç„¶ziplistè¿™ä¹ˆå¤æ‚ï¼Œé‚£æˆ‘ä»¬å°±ç®€å•ä¸€ç‚¹ï¼Œç«™åœ¨crudçš„è§’åº¦æ’¸å®ƒä¸€ä¸‹ã€‚
åœ¨åˆ›å»ºziplist åˆ›å»ºä¸€ä¸ªinsertæ’å…¥ä¸€ä¸‹ä¹‹å‰ã€‚
æˆ‘ä»¬æ¥çœ‹ä¸€äº›æºç ï¼Œå›å¿†ä¸€ä¸‹ziplistçš„ç»“æ„

1. æŸ¥çœ‹ä¸€ä¸ªziplistçš„å¤§å° (å ç”¨çš„å­—èŠ‚æ•°)
```javascript
// å®šä½åˆ° ziplist çš„ bytes å±æ€§ï¼Œè¯¥å±æ€§è®°å½•äº†æ•´ä¸ª ziplist æ‰€å ç”¨çš„å†…å­˜å­—èŠ‚æ•°
// ç”¨äºå–å‡º bytes å±æ€§çš„ç°æœ‰å€¼ï¼Œæˆ–è€…ä¸º bytes å±æ€§èµ‹äºˆæ–°å€¼
#define ZIPLIST_BYTES(zl) (*((uint32_t *)(zl)))
```
2. æŸ¥çœ‹ziplistçš„å°¾èŠ‚ç‚¹çš„åç§»é‡
 ```javascript
// å®šä½åˆ° ziplist çš„ offset å±æ€§ï¼Œè¯¥å±æ€§è®°å½•äº†åˆ°è¾¾è¡¨å°¾èŠ‚ç‚¹çš„åç§»é‡
// ç”¨äºå–å‡º offset å±æ€§çš„ç°æœ‰å€¼ï¼Œæˆ–è€…ä¸º offset å±æ€§èµ‹äºˆæ–°å€¼
#define ZIPLIST_TAIL_OFFSET(zl) (*((uint32_t *)((zl) + sizeof(uint32_t))))
```

3. æŸ¥çœ‹ziplistçš„èŠ‚ç‚¹ä¸ªæ•°
 ```javascript
// å®šä½åˆ° ziplist çš„ length å±æ€§ï¼Œè¯¥å±æ€§è®°å½•äº† ziplist åŒ…å«çš„èŠ‚ç‚¹æ•°é‡
// ç”¨äºå–å‡º length å±æ€§çš„ç°æœ‰å€¼ï¼Œæˆ–è€…ä¸º length å±æ€§èµ‹äºˆæ–°å€¼
#define ZIPLIST_LENGTH(zl) (*((uint16_t *)((zl) + sizeof(uint32_t) * 2)))
```
4. æŸ¥çœ‹ ziplist è¡¨å¤´çš„å¤§å°
  ```javascript
// è¿”å› ziplist è¡¨å¤´çš„å¤§å°
#define ZIPLIST_HEADER_SIZE (sizeof(uint32_t) * 2 + sizeof(uint16_t))
```
5. æŸ¥çœ‹ ziplist è¡¨å¤´çš„å¤§å°
  ```javascript
// è¿”å›æŒ‡å‘ ziplist ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆçš„èµ·å§‹ä½ç½®ï¼‰çš„æŒ‡é’ˆ
#define ZIPLIST_ENTRY_HEAD(zl) ((zl) + ZIPLIST_HEADER_SIZE)
```
6. æŸ¥çœ‹ ziplist æœ€åä¸€ä¸ªèŠ‚ç‚¹
```javascript
// è¿”å›æŒ‡å‘ ziplist æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼ˆçš„èµ·å§‹ä½ç½®ï¼‰çš„æŒ‡é’ˆ
#define ZIPLIST_ENTRY_TAIL(zl) ((zl) + intrev32ifbe(ZIPLIST_TAIL_OFFSET(zl)))
```
7. æŸ¥çœ‹ ziplist æœ€åä¸€ä¸ªèŠ‚ç‚¹
```javascript
// è¿”å›æŒ‡å‘ ziplist æœ«ç«¯ ZIP_END ï¼ˆçš„èµ·å§‹ä½ç½®ï¼‰çš„æŒ‡é’ˆ
#define ZIPLIST_ENTRY_END(zl) ((zl) + intrev32ifbe(ZIPLIST_BYTES(zl)) - 1)
```

8. 
## å°ç»“
åˆåˆ°äº†å°ç»“æ—¶é—´ï¼Œè·‘ä¸ªé¢˜ã€‚
å¤åˆ¶å‡½æ•°dupï¼Œå’ŒåŒ¹é…å‡½æ•°match å¦‚æœå¿˜äº†è®¾ç½®ï¼Œåœ¨è°ƒè¯•é˜¶æ®µï¼Œæ¯”è¾ƒå®¹æ˜“å‘ç°ã€‚
listçš„freeå‡½æ•°ï¼Œå¦‚æœvalueæŒ‡å‘çš„ç»“æ„éœ€è¦é‡Šæ”¾ï¼Œä½†æ˜¯å¿˜äº†è®¾ç½®ï¼Œå†™å®Œè°ƒè¯•é˜¶æ®µç›¸å¯¹è¾ƒéš¾å‘ç°ï¼Œå®¹æ˜“ä¼šå‡ºç°å†…å­˜æ³„æ¼ã€‚


 # å¾€æœŸåšå®¢å›é¡¾
1. [redisæœåŠ¡å™¨çš„éƒ¨åˆ†å¯åŠ¨è¿‡ç¨‹](https://blog.csdn.net/a158372582/article/details/106023071)
2.  [GETå‘½ä»¤èƒŒåçš„æºç é€»è¾‘](https://editor.csdn.net/md/?articleId=106035658)
3. [redisçš„åŸºç¡€æ•°æ®ç»“æ„ä¹‹ sds](https://blog.csdn.net/a158372582/article/details/106063645)
4. [redisçš„åŸºç¡€æ•°æ®ç»“æ„ä¹‹ list](https://blog.csdn.net/a158372582/article/details/106086284)
